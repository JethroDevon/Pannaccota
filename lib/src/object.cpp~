#include "../header/object.h"



Object::Object(){

  head.next = NULL;
}

void Object::push(unsigned char *chardata, std::string datalabel, int datatype){

  //create and init node
  struct Node* newNode = new Node;
  newNode->data = chardata;
  newNode->label = datalabel;
  
  //adds length of label to first nibbleh of metadata byte 
  int length = newNode->label.length();
  if(length > 15){
    newNode->label = newNode->label.substr(15);
  }
  newNode->metadata = (char)length;
  
  //converts type into flipping the appropriate bit in the second half of the metadata nibbleh
  if(datatype <= 4 && datatype > 0){

      newNode->metadata |= 1UL << ((4 + datatype) -1);  
  }

  newNode->localsize = strlen(chardata);

  //link node to head
  newNode->next = head.next;
  head.next = newNode;
}



unsigned char* Object::get(){

  return head.next->data;
}

void Object::getAll(){

  struct Node* temp = new Node;
  temp = head.next;
  
  while (temp != NULL){

    std::cout << temp->data << " " << strlen((char*)temp->data)<< " " << temp->label << " ";

    for(int x = 0; x < 8; x++){

      int y = ((byte >> x) & 1);
      std::cout << y;
    }
  
    std::cout << std::endl;
    temp = temp->next;
  }
}
